%% FLOW FUNCTION ==========================================================

function out = FUNC_flow(t,x,y,z,flowType,dataFlow)

np = length(x);

switch flowType
    
    case 0 % Uniform Flow -------------------------------------------------
        
        out.u(1:np,1) = ones(np,1);
        out.v(1:np,1) = zeros(np,1);
        out.w(1:np,1) = zeros(np,1);
        
        out.dudx(1:np,1)  = zeros(np,1);
        out.d2udx(1:np,1) = zeros(np,1);
        out.d2udxdy(1:np,1) = zeros(np,1);
        out.dudy(1:np,1)  = zeros(np,1);
        out.d2udy(1:np,1) = zeros(np,1);
        out.dudz(1:np,1)  = zeros(np,1);
        out.d2udz(1:np,1) = zeros(np,1);
        
        out.dvdx(1:np,1)  = zeros(np,1);
        out.d2vdx(1:np,1) = zeros(np,1);
        out.d2vdxdy(1:np,1) = zeros(np,1);
        out.dvdy(1:np,1)  = zeros(np,1);
        out.d2vdy(1:np,1) = zeros(np,1);
        out.dvdz(1:np,1)  = zeros(np,1);
        out.d2vdz(1:np,1) = zeros(np,1);
        
        out.dwdx(1:np,1)  = zeros(np,1);
        out.d2wdx(1:np,1) = zeros(np,1);
        out.dwdy(1:np,1)  = zeros(np,1);
        out.d2wdy(1:np,1) = zeros(np,1);
        out.dwdz(1:np,1)  = zeros(np,1);
        out.d2wdz(1:np,1) = zeros(np,1);
        
        
        
    case 1 % Moving cylinder ----------------------------------------------
        
        yc    = dataFlow.yc;
        R     = dataFlow.R;
        U0    = dataFlow.U0;
        beta  = dataFlow.beta;
        wc    = dataFlow.wc;
        Omega = dataFlow.Omega;
        Uw    = -U0;
        
        if beta == 0
            wc = 1;
        end
        
        % Change in variable
        x = x-Uw*t-(beta/wc)*cos(wc*t);
        
        a     = (R+yc-sqrt(yc^2-R^2))/(R+yc+sqrt(yc^2-R^2));
        mu    = 1/sqrt(yc^2-R^2);
        sigma = (a/(a^2-1))*(-Uw/(2*log(a)) + (2*Omega*a^2)/(mu*(a^2-1)^2));
        i     = sqrt(-1);
        z     = x+i.*y;
        xi    = (1+i.*mu.*z)./(1+mu.*z);
        
        T1    = 2*log(abs(xi)/a) + (mu/(2*xi)).*(conj(z)-z).*(xi-i).^2;
        T2    = (i*mu*conj(z)/2).*(a./xi.^2+1/a) - (i./xi)*(a+1/a) + (1/(2*a))*(a^2./xi.^2-1);
        T3    = a + 1/a + i*(a./conj(xi)-conj(xi)/a);
        
        w     = (-Uw./(2*log(a)))*T1 + sigma*(xi-i).^2.*T2 + sigma*T3;
        %         u     = real(w);
        %         v     = -imag(w);
        
        out.u(1:np,1) = real(w)+Uw;
        out.v(1:np,1) = -imag(w);
        out.w(1:np,1) = zeros(np,1);
        
        out.dudx(1:np,1)  = zeros(np,1);
        out.d2udx(1:np,1) = zeros(np,1);
        out.dudy(1:np,1)  = zeros(np,1);
        out.d2udy(1:np,1) = zeros(np,1);
        out.dudz(1:np,1)  = zeros(np,1);
        out.d2udz(1:np,1) = zeros(np,1);
        
        out.dvdx(1:np,1)  = zeros(np,1);
        out.d2vdx(1:np,1) = zeros(np,1);
        out.dvdy(1:np,1)  = zeros(np,1);
        out.d2vdy(1:np,1) = zeros(np,1);
        out.dvdz(1:np,1)  = zeros(np,1);
        out.d2vdz(1:np,1) = zeros(np,1);
        
        out.dwdx(1:np,1)  = zeros(np,1);
        out.d2wdx(1:np,1) = zeros(np,1);
        out.dwdy(1:np,1)  = zeros(np,1);
        out.d2wdy(1:np,1) = zeros(np,1);
        out.dwdz(1:np,1)  = zeros(np,1);
        out.d2wdz(1:np,1) = zeros(np,1);
        
    case 2 % vKVS ---------------------------------------------------------
        
        rad     = (x.^2+y.^2).^0.5;
        Tc      = 1.107;
        alpha   = 2;
        R0      = 0.35;
        L       = 2;
        a       = 1;
        y0      = 0.3;
        Uref    = dataFlow.Uref; %%%%%%%I think this might be changed, see the paper Re=250
        u0      = (14/Tc)/Uref;
        w       = 8*24/pi;
        
        for nah=1:1
            
            out.Psi = (1+(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2)) ...
                .*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).* ...
                u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod(( ...
                -1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))));
            
            out.u(1:np,1) = 2.*a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*y.*(x.^2+y.^2).^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*((1+(-1) ...
                .*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp( ...
                1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1), ...
                1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(1+(-1).*exp(1).^((-1).* ...
                a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2)).*(exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^( ...
                -2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp( ...
                1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.* ...
                Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))));
            
            out.v(1:np,1) = (-2).*a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*(x.^2+y.^2).^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*((1+ ...
                (-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+ ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^( ...
                (-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-2).*(1+(-1).*exp(1).^(( ...
                -1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2)).*(alpha.^(-2).*exp( ...
                1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+ ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).* ...
                x+L.*mod((-1/2)+t.*Tc.^(-1),1))+exp(1).^((-1).*R0.*(alpha.^2.*(y+( ...
                -1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs( ...
                sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(t.*Tc.^(-1),1)));
            
            out.dudx(1:np,1)  = 2.*(a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*x.*y.*(x.^2+y.^2).^(-1).*((1+(-1).*exp(1).^((-1).*alpha.^( ...
                -2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(-1).*a.^(-1/2).*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).^(-3/2).*( ...
                (-1)+(x.^2+y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*(( ...
                -1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0) ...
                .^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.* ...
                t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+ ...
                (1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+(-2).*a.^(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*y.*(x.^2+y.^2).^(-1).*((-1)+(x.^2+y.^2).^(1/2)).^2.* ...
                ((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).* ...
                u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod(( ...
                -1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+a.^(-1/2).* ...
                exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+ ...
                y.^2).^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*(exp(1).^((-1).*alpha.^( ...
                -2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^(-2).*(( ...
                -1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1), ...
                1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))))+2.*a.^( ...
                -1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).* ...
                y.*(x.^2+y.^2).^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*(alpha.^(-2).* ...
                exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x) ...
                .*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod(( ...
                -1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*(1+( ...
                -1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1))+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(t.*Tc.^(-1) ...
                ,1)))+alpha.^(-2).*(1+(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+ ...
                y.^2).^(1/2)).^2)).*(u0.*((-1)+x)+(-1).*exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*((-1)+exp(1).^(alpha.^( ...
                -2).*((-1)+x).^2+y.^2)+2.*y.^2)+2.*alpha.^4.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*R0.^2.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.* ...
                mod((-1/2)+t.*Tc.^(-1),1))+2.*alpha.^4.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.^2.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.* ...
                mod(t.*Tc.^(-1),1))));
            
            out.dudy(1:np,1)  = 2.*a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*y.^2.*(x.^2+y.^2).^(-1).*((1+(-1).*exp(1).^((-1).*alpha.^( ...
                -2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(-2).*a.^(-1/2).*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*y.^2.*(x.^2+y.^2).^(-3/2).*( ...
                (-1)+(x.^2+y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*(( ...
                -1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0) ...
                .^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.* ...
                t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+ ...
                (1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+2.*a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*(x.^2+y.^2).^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*((1+( ...
                -1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+ ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^( ...
                (-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-4).*a.^(-1).*exp(1).^(( ...
                -1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*y.^2.*(x.^2+y.^2) ...
                .^(-1).*((-1)+(x.^2+y.^2).^(1/2)).^2.*((1+(-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(1+(-1).*exp(1).^((-1).*a.^(-1/2).*( ...
                (-1)+(x.^2+y.^2).^(1/2)).^2)).*(exp(1).^((-1).*alpha.^(-2).*((-1)+ ...
                x).^2+(-1).*y.^2).*u0.*(6.*y+(-4).*y.^3)+2.*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*R0.*w.*((-1)+2.*alpha.^2.*R0.*(y+y0).^2).*abs(cos(pi.* ...
                t.*Tc.^(-1)))+(-2).*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+( ...
                -1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*((-1)+ ...
                2.*alpha.^2.*R0.*(y+(-1).*y0).^2).*abs(sin(pi.*t.*Tc.^(-1))))+4.* ...
                a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2) ...
                .*y.*(x.^2+y.^2).^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*(exp(1).^(( ...
                -1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^( ...
                alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1) ...
                )));
            
            out.dvdx(1:np,1)  = (-2).*a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.^2.*(x.^2+y.^2).^(-1).*((1+(-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(-2).*a.^(-1/2).*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.^2.*(x.^2+y.^2).^(-3/2).*( ...
                1+(-1).*(x.^2+y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs( ...
                cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1) ...
                .*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.* ...
                t.*Tc.^(-1))))+2.*a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2).*(x.^2+y.^2).^(-1/2).*(1+(-1).*(x.^2+y.^2) ...
                .^(1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).* ...
                y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+( ...
                -1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.* ...
                mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+4.*a.^(-1) ...
                .*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*(x.^2+ ...
                y.^2).^(-1).*(x+(-1).*x.*(x.^2+y.^2).^(1/2)).^2.*((1+(-1).*exp(1) ...
                .^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(-8).*a.^(-1/2).*alpha.^(-2).*exp(1) ...
                .^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+y.^2) ...
                .^(-1/2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1) ...
                ))+(-2).*alpha.^(-4).*(1+(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2)).*(alpha.^2.*exp(1).^((-1).*alpha.^(-2).*(( ...
                -1)+x).^2+(-1).*y.^2).*u0.*y+(-2).*exp(1).^((-1).*alpha.^(-2).*(( ...
                -1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).^2.*y+(-1).*alpha.^4.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1)))+alpha.^4.*exp( ...
                1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.* ...
                Tc.^(-1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1)))+2.*alpha.^4.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1) ...
                .*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2+(-2).*alpha.^4.*exp(1).^((-1) ...
                .*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)) ...
                .^2)).*R0.^2.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.* ...
                Tc.^(-1),1)).^2);
            
            out.dvdy(1:np,1)  = (-2).*a.^(-1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*y.*(x.^2+y.^2).^(-1).*((1+(-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+2.*a.^(-1/2).*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).^(-3/2).*( ...
                (-1)+(x.^2+y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*(( ...
                -1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0) ...
                .^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.* ...
                t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+ ...
                (1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+4.*a.^(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2) ...
                ).^2).*x.*y.*(x.^2+y.^2).^(-1).*((-1)+(x.^2+y.^2).^(1/2)).^2.*((1+ ...
                (-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+ ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^( ...
                (-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-2).*a.^(-1/2).*exp(1) ...
                .^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+y.^2) ...
                .^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*(exp(1).^((-1).*alpha.^(-2).* ...
                ((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+x) ...
                .^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+ ...
                y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))))+(-4).*a.^(-1/2).* ...
                exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*y.*(x.^2+ ...
                y.^2).^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).*(alpha.^(-2).*exp(1).^(( ...
                -1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1))+exp(1).^((-1).*R0.*(alpha.^2.*(y+( ...
                -1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs( ...
                sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(t.*Tc.^(-1),1)))+(-2) ...
                .*alpha.^(-2).*(1+(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+ ...
                y.^2).^(1/2)).^2)).*(exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1) ...
                .*y.^2).*u0.*((-1)+x)+(-2).*exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2).*u0.*((-1)+x).*y.^2+2.*alpha.^4.*exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*R0.^2.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).* ...
                L.*mod((-1/2)+t.*Tc.^(-1),1))+(-2).*alpha.^4.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.^2.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).* ...
                L.*mod(t.*Tc.^(-1),1)));
            
            out.d2udx(1:np,1) = 4.*a.^(-3/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*y.*(x.^2+y.^2).^(-2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-2).* ...
                x.^4.*((-2)+(x.^2+y.^2).^(1/2))+a.^(1/2).*y.^2.*((-1)+(x.^2+y.^2) ...
                .^(1/2))+x.^2.*(((-2)+a.^(1/2)).*(x.^2+y.^2).^(1/2)+(-2).*y.^2.*(( ...
                -2)+(x.^2+y.^2).^(1/2)))).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*( ...
                (-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+ ...
                y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos( ...
                pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0) ...
                .^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.* ...
                Tc.^(-1))))+2.*a.^(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+ ...
                y.^2).^(1/2)).^2).*(x.^2+y.^2).^(-3/2).*((-2).*x.^4.*((-2)+(x.^2+ ...
                y.^2).^(1/2))+a.^(1/2).*y.^2.*((-1)+(x.^2+y.^2).^(1/2))+x.^2.*((( ...
                -2)+a.^(1/2)).*(x.^2+y.^2).^(1/2)+(-2).*y.^2.*((-2)+(x.^2+y.^2).^( ...
                1/2)))).*(exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).* ...
                u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).* ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.* ...
                mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.* ...
                Tc.^(-1)))+2.*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0) ...
                .^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).* ...
                abs(sin(pi.*t.*Tc.^(-1))))+8.*a.^(-1/2).*alpha.^(-2).*exp(1).^(( ...
                -1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+y.^2).^( ...
                -1/2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*(u0+(-1).*u0.*x+exp(1).^((-1) ...
                .*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*((-1)+exp(1) ...
                .^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+2.*alpha.^4.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*R0.^2.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).* ...
                x+L.*mod((-1/2)+t.*Tc.^(-1),1))+2.*alpha.^4.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.^2.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).* ...
                L.*mod(t.*Tc.^(-1),1)))+2.*alpha.^(-4).*(1+(-1).*exp(1).^((-1).* ...
                a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2)).*(u0.*(alpha.^2+2.*((-1) ...
                +x).^2)+(-4).*u0.*((-1)+x).^2+(-1).*exp(1).^((-1).*alpha.^(-2).*(( ...
                -1)+x).^2+(-1).*y.^2).*u0.*(alpha.^2+(-2).*((-1)+x).^2).*((-1)+ ...
                exp(1).^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^6.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1))) ...
                .*((-1)+2.*R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x).*mod((-1/2)+t.* ...
                Tc.^(-1),1)+2.*L.^2.*R0.*mod((-1/2)+t.*Tc.^(-1),1).^2)+2.* ...
                alpha.^6.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+(-1).*y0).*abs(sin( ...
                pi.*t.*Tc.^(-1))).*((-1)+2.*R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x) ...
                .*mod(t.*Tc.^(-1),1)+2.*L.^2.*R0.*mod(t.*Tc.^(-1),1).^2))+8.*a.^( ...
                -1).*alpha.^(-2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*y.*(x.^2+y.^2).^(-2).*(1+(-1).*(x.^2+y.^2).^(1/2)).* ...
                (alpha.^2.*x.*(x.^2+y.^2).^(1/2).*((1+(-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+alpha.^2.*x.*(1+(-1).*(x.^2+y.^2).^( ...
                1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).* ...
                y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+( ...
                -1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.* ...
                mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+2.*(x.^2+ ...
                y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1) ...
                )))+(-2).*a.^(-1/2).*alpha.^(-4).*exp(1).^((-1).*a.^(-1/2).*((-1)+ ...
                (x.^2+y.^2).^(1/2)).^2).*y.*(x.^2+y.^2).^(-5/2).*(alpha.^4.*(2.* ...
                x.^2+(-1).*y.^2).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+( ...
                1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.* ...
                Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+ ...
                (-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1)))) ...
                +4.*alpha.^2.*x.*(x.^2+y.^2).*((-1).*exp(1).^((-1).*alpha.^(-2).*( ...
                (-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.*exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(( ...
                -1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+( ...
                -1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs( ...
                sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)))+(x.^2+ ...
                y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(2.*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*(alpha.^2+(-2).*((-1)+x) ...
                .^2).*y+2.*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+( ...
                -1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.* ...
                Tc.^(-1))).*((-1)+2.*R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x).*mod(( ...
                -1/2)+t.*Tc.^(-1),1)+2.*L.^2.*R0.*mod((-1/2)+t.*Tc.^(-1),1).^2)+( ...
                -2).*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+( ...
                -1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                )).*((-1)+2.*R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x).*mod(t.*Tc.^( ...
                -1),1)+2.*L.^2.*R0.*mod(t.*Tc.^(-1),1).^2)));
            
            out.d2udy(1:np,1) = 4.*a.^(-3/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*y.*(x.^2+y.^2).^(-2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-2).* ...
                y.^2.*((x.^2+y.^2).^(1/2)+x.^2.*((-2)+(x.^2+y.^2).^(1/2))+y.^2.*(( ...
                -2)+(x.^2+y.^2).^(1/2)))+a.^(1/2).*(3.*x.^2.*((-1)+(x.^2+y.^2).^( ...
                1/2))+y.^2.*((-2)+3.*(x.^2+y.^2).^(1/2)))).*((1+(-1).*exp(1).^(( ...
                -1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(-4).*a.^(-1/2).*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*y.*(x.^2+y.^2).^(-1/2).*(1+( ...
                -1).*(x.^2+y.^2).^(1/2)).*(exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2).*u0.*(6.*y+(-4).*y.^3)+2.*alpha.^2.*exp(1).^((-1) ...
                .*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1) ...
                ).^2)).*R0.*w.*((-1)+2.*alpha.^2.*R0.*(y+y0).^2).*abs(cos(pi.*t.* ...
                Tc.^(-1)))+(-2).*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).* ...
                y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*((-1)+2.* ...
                alpha.^2.*R0.*(y+(-1).*y0).^2).*abs(sin(pi.*t.*Tc.^(-1))))+2.*a.^( ...
                -1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*( ...
                x.^2+y.^2).^(-3/2).*((-2).*y.^2.*((x.^2+y.^2).^(1/2)+x.^2.*((-2)+( ...
                x.^2+y.^2).^(1/2))+y.^2.*((-2)+(x.^2+y.^2).^(1/2)))+a.^(1/2).*( ...
                y.^2.*(x.^2+y.^2).^(1/2)+x.^2.*((-1)+(x.^2+y.^2).^(1/2)))).*(exp( ...
                1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1) ...
                .^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.* ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.* ...
                t.*Tc.^(-1))))+(-1).*(1+(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2)).*((-2).*exp(1).^((-1).*alpha.^(-2).*((-1)+ ...
                x).^2+(-1).*y.^2).*u0.*(3+(-12).*y.^2+4.*y.^4)+4.*alpha.^4.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+y0).*((-3)+2.*alpha.^2.*R0.*(y+y0) ...
                .^2).*abs(cos(pi.*t.*Tc.^(-1)))+(-4).*alpha.^4.*exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)) ...
                .^2)).*R0.^2.*w.*((-3)+2.*alpha.^2.*R0.*(y+(-1).*y0).^2).*(y+(-1) ...
                .*y0).*abs(sin(pi.*t.*Tc.^(-1))))+2.*a.^(-1/2).*exp(1).^((-1).* ...
                a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*y.*(x.^2+y.^2).^(-5/2).* ...
                ((x.^2+(-2).*y.^2).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+( ...
                1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.* ...
                Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+ ...
                (-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1)))) ...
                +(-1).*(x.^2+y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(4.*exp(1).^( ...
                (-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*y+exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*(2.*y+(-4).*y.^3)+2.* ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.* ...
                mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*((-1)+2.*alpha.^2.*R0.*(y+ ...
                y0).^2).*abs(cos(pi.*t.*Tc.^(-1)))+(-2).*alpha.^2.*exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)) ...
                .^2)).*R0.*w.*((-1)+2.*alpha.^2.*R0.*(y+(-1).*y0).^2).*abs(sin( ...
                pi.*t.*Tc.^(-1))))+2.*y.*(x.^2+y.^2).*(exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+ ...
                x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1), ...
                1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1)))))+4.*a.^( ...
                -1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*( ...
                x.^2+y.^2).^(-2).*(a.^(1/2).*(x.^2+y.^2).^(1/2)+(-2).*y.^2.*((-1)+ ...
                (x.^2+y.^2).^(1/2))).*(y.*(x.^2+y.^2).^(1/2).*((1+(-1).*exp(1).^(( ...
                -1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+y.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(( ...
                1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.* ...
                y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2) ...
                +t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^( ...
                -1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-1).*(x.^2+y.^2).*(1+ ...
                (-1).*(x.^2+y.^2).^(1/2)).*(exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+x).^2+y.^2) ...
                +2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+ ...
                (1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+y0).*abs( ...
                cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+( ...
                -1).*y0).*abs(sin(pi.*t.*Tc.^(-1)))));
            
            out.d2vdx(1:np,1) = (-4).*a.^(-3/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*(x.^2+y.^2).^(-2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*(( ...
                -2).*x.^2.*((x.^2+y.^2).^(1/2)+x.^2.*((-2)+(x.^2+y.^2).^(1/2))+ ...
                y.^2.*((-2)+(x.^2+y.^2).^(1/2)))+a.^(1/2).*(3.*y.^2.*((-1)+(x.^2+ ...
                y.^2).^(1/2))+x.^2.*((-2)+3.*(x.^2+y.^2).^(1/2)))).*((1+(-1).*exp( ...
                1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+4.*a.^(-1).*alpha.^(-2).*exp(1).^(( ...
                -1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*(x.^2+y.^2).^(-3/2) ...
                .*((-2).*x.^4.*((-2)+(x.^2+y.^2).^(1/2))+a.^(1/2).*y.^2.*((-1)+( ...
                x.^2+y.^2).^(1/2))+x.^2.*(((-2)+a.^(1/2)).*(x.^2+y.^2).^(1/2)+(-2) ...
                .*y.^2.*((-2)+(x.^2+y.^2).^(1/2)))).*((-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1) ...
                ))+8.*a.^(-1/2).*alpha.^(-4).*exp(1).^((-1).*a.^(-1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+y.^2).^(-1/2).*(1+(-1).*(x.^2+ ...
                y.^2).^(1/2)).*(alpha.^2.*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+ ...
                (-1).*y.^2).*u0.*y+(-2).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+( ...
                -1).*y.^2).*u0.*((-1)+x).^2.*y+(-1).*alpha.^4.*exp(1).^((-1).*R0.* ...
                (alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*R0.*w.*abs(cos(pi.*t.*Tc.^(-1)))+alpha.^4.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1)))+2.*alpha.^4.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*R0.^2.*w.*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2+(-2).*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.* ...
                abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)+( ...
                -2).*alpha.^(-6).*(1+(-1).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+ ...
                y.^2).^(1/2)).^2)).*((-4).*alpha.^2.*exp(1).^((-1).*alpha.^(-2).*( ...
                (-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+2.*exp(1).^((-1).*alpha.^( ...
                -2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1).*alpha.^2+2.*((-1)+x).^2) ...
                .*((-1)+x).*y+4.*alpha.^6.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0) ...
                .^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*abs( ...
                cos(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                +(-2).*alpha.^6.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).* ...
                x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*abs(cos(pi.*t.* ...
                Tc.^(-1))).*((-1)+x+(-1).*L.*mod((-1/2)+t.*Tc.^(-1),1)).*((-1)+2.* ...
                R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x).*mod((-1/2)+t.*Tc.^(-1),1)+ ...
                2.*L.^2.*R0.*mod((-1/2)+t.*Tc.^(-1),1).^2)+4.*alpha.^6.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1), ...
                1)).^2)).*R0.^2.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1))+2.*alpha.^6.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1) ...
                .*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*abs( ...
                sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(t.*Tc.^(-1),1)).*((-1) ...
                +2.*R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x).*mod(t.*Tc.^(-1),1)+2.* ...
                L.^2.*R0.*mod(t.*Tc.^(-1),1).^2))+(-4).*a.^(-1).*alpha.^(-2).*exp( ...
                1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*(x.^2+y.^2) ...
                .^(-2).*(a.^(1/2).*(x.^2+y.^2).^(1/2)+(-2).*x.^2.*((-1)+(x.^2+ ...
                y.^2).^(1/2))).*(alpha.^2.*x.*(x.^2+y.^2).^(1/2).*((1+(-1).*exp(1) ...
                .^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+alpha.^2.*x.*(1+(-1).*(x.^2+y.^2).^( ...
                1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).* ...
                y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+( ...
                -1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.* ...
                mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+2.*(x.^2+ ...
                y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1) ...
                )))+2.*a.^(-1/2).*alpha.^(-4).*exp(1).^((-1).*a.^(-1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+y.^2).^(-5/2).*(alpha.^4.*(2.* ...
                x.^2+(-1).*y.^2).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+( ...
                1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.* ...
                Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+ ...
                (-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1)))) ...
                +4.*alpha.^2.*x.*(x.^2+y.^2).*((-1).*exp(1).^((-1).*alpha.^(-2).*( ...
                (-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.*exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(( ...
                -1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+( ...
                -1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs( ...
                sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)))+(x.^2+ ...
                y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(2.*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*(alpha.^2+(-2).*((-1)+x) ...
                .^2).*y+2.*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+( ...
                -1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.* ...
                Tc.^(-1))).*((-1)+2.*R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x).*mod(( ...
                -1/2)+t.*Tc.^(-1),1)+2.*L.^2.*R0.*mod((-1/2)+t.*Tc.^(-1),1).^2)+( ...
                -2).*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+( ...
                -1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                )).*((-1)+2.*R0.*((-1)+x).^2+(-4).*L.*R0.*((-1)+x).*mod(t.*Tc.^( ...
                -1),1)+2.*L.^2.*R0.*mod(t.*Tc.^(-1),1).^2)));
            
            out.d2vdy(1:np,1) = (-2).*a.^(-3/2).*alpha.^(-2).*(x.^2+y.^2).^(-5/2).*(2.*alpha.^2.* ...
                exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+ ...
                y.^2).^(1/2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-2).*y.^2.*((x.^2+ ...
                y.^2).^(1/2)+x.^2.*((-2)+(x.^2+y.^2).^(1/2))+y.^2.*((-2)+(x.^2+ ...
                y.^2).^(1/2)))+a.^(1/2).*(y.^2.*(x.^2+y.^2).^(1/2)+x.^2.*((-1)+( ...
                x.^2+y.^2).^(1/2)))).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+ ...
                x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+ ...
                (1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.* ...
                Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+ ...
                (-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1)))) ...
                +a.*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*x.*((x.^2+(-2).*y.^2).*((1+(-1).*exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs( ...
                cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1) ...
                .*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.* ...
                t.*Tc.^(-1))))+(-1).*(x.^2+y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)) ...
                .*(4.*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*y+ ...
                exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*(2.*y+( ...
                -4).*y.^3)+2.*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+( ...
                1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*((-1)+2.* ...
                alpha.^2.*R0.*(y+y0).^2).*abs(cos(pi.*t.*Tc.^(-1)))+(-2).* ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*((-1)+2.*alpha.^2.*R0.*(y+( ...
                -1).*y0).^2).*abs(sin(pi.*t.*Tc.^(-1))))+2.*y.*(x.^2+y.^2).*(exp( ...
                1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1) ...
                .^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.* ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.* ...
                t.*Tc.^(-1)))))+4.*a.^(1/2).*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*( ...
                (-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).^(1/2).*(1+(-1).*( ...
                x.^2+y.^2).^(1/2)).*(y.*(x.^2+y.^2).^(1/2).*((1+(-1).*exp(1).^(( ...
                -1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+y.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(( ...
                1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.* ...
                y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2) ...
                +t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^( ...
                -1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-1).*(x.^2+y.^2).*(1+ ...
                (-1).*(x.^2+y.^2).^(1/2)).*(exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+x).^2+y.^2) ...
                +2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+ ...
                (1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+y0).*abs( ...
                cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+( ...
                -1).*y0).*abs(sin(pi.*t.*Tc.^(-1)))))+a.^(3/2).*(1+(-1).*exp(1).^( ...
                (-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2)).*(x.^2+y.^2).^( ...
                5/2).*((-4).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).* ...
                u0.*((-1)+x).*y+2.*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).* ...
                y.^2).*u0.*((-1)+x).*y.*((-1)+2.*y.^2)+(-2).*alpha.^4.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*R0.^2.*w.*((-1)+2.*alpha.^2.*R0.*(y+y0).^2).*abs(cos( ...
                pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+2.* ...
                alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*((-1)+2.*alpha.^2.*R0.*( ...
                y+(-1).*y0).^2).*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod( ...
                t.*Tc.^(-1),1)))+4.*a.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2) ...
                .^(1/2)).^2).*y.*(x.^2+y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(( ...
                -1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*(( ...
                -1)+x)+2.*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).* ...
                u0.*((-1)+x).*y.^2+2.*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+ ...
                y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*( ...
                y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1))+2.*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).* ...
                y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+(-1).* ...
                y0).*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(t.*Tc.^(-1), ...
                1)))+(-2).*a.^(1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2) ...
                .^(1/2)).^2).*(x.^2+y.^2).*((-2).*y.^2.*((x.^2+y.^2).^(1/2)+x.^2.* ...
                ((-2)+(x.^2+y.^2).^(1/2))+y.^2.*((-2)+(x.^2+y.^2).^(1/2)))+a.^( ...
                1/2).*(y.^2.*(x.^2+y.^2).^(1/2)+x.^2.*((-1)+(x.^2+y.^2).^(1/2)))) ...
                .*((-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.* ...
                ((-1)+x).*y+alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+( ...
                -1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.* ...
                Tc.^(-1))).*((-1)+x+(-1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1))));
            
            out.d2udxdy(1:np,1) = 2.*a.^(-3/2).*alpha.^(-2).*(x.^2+y.^2).^(-5/2).*((-3).*a.* ...
                alpha.^2.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2) ...
                .*x.*y.^2.*(x.^2+y.^2).^(1/2).*((1+(-1).*exp(1).^((-1).*alpha.^( ...
                -2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+a.*alpha.^2.*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+y.^2).^(3/2).*((1+( ...
                -1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+ ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^( ...
                (-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-3).*a.*alpha.^2.*exp(1) ...
                .^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.^2.*(1+( ...
                -1).*(x.^2+y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*(( ...
                -1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0) ...
                .^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.* ...
                t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+ ...
                (1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+a.*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*(x.^2+y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((1+(-1) ...
                .*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp( ...
                1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1), ...
                1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+6.*a.^(1/2).*alpha.^2.* ...
                exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.^2.* ...
                (x.^2+y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1) ...
                .*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.* ...
                (alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(-4).*alpha.^2.*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.^2.*(x.^2+y.^2).*(1+( ...
                -1).*(x.^2+y.^2).^(1/2)).^3.*((1+(-1).*exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs( ...
                cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1) ...
                .*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.* ...
                t.*Tc.^(-1))))+6.*a.^(1/2).*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*(( ...
                -1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.^2.*(x.^2+y.^2).^(1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2.*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1) ...
                +x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0) ...
                .^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.* ...
                t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+ ...
                (1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+(-2).*a.^(1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*(x.^2+y.^2).^(3/2).*(alpha+(-1).*alpha.*(x.^2+y.^2) ...
                .^(1/2)).^2.*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+( ...
                -1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1) ...
                .*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1) ...
                ))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+ ...
                L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-1).* ...
                a.*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*x.*(x.^2+y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(exp(1).^(( ...
                -1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*(6.*y+(-4).*y.^3)+ ...
                2.*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*((-1)+2.*alpha.^2.*R0.* ...
                (y+y0).^2).*abs(cos(pi.*t.*Tc.^(-1)))+(-2).*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1), ...
                1)).^2)).*R0.*w.*((-1)+2.*alpha.^2.*R0.*(y+(-1).*y0).^2).*abs(sin( ...
                pi.*t.*Tc.^(-1))))+2.*a.*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*((-1) ...
                +(x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).^(3/2).*(exp(1).^((-1) ...
                .*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^( ...
                alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+2.*a.*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*x.*y.*(x.^2+y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*(exp( ...
                1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1) ...
                .^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.* ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.* ...
                t.*Tc.^(-1))))+(-4).*a.^(1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).^(3/2).*(alpha+(-1).* ...
                alpha.*(x.^2+y.^2).^(1/2)).^2.*(exp(1).^((-1).*alpha.^(-2).*((-1)+ ...
                x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+x).^2+ ...
                y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+ ...
                y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+ ...
                y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))))+2.*a.*exp(1).^(( ...
                -1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*y.*(x.^2+y.^2).^2.* ...
                (1+(-1).*(x.^2+y.^2).^(1/2)).*((-1).*exp(1).^((-1).*alpha.^(-2).*( ...
                (-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x)+2.*exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y.^2+2.*alpha.^4.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*( ...
                1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1))+2.*alpha.^4.*exp(1).^((-1) ...
                .*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)) ...
                .^2)).*R0.^2.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+ ...
                (-1).*L.*mod(t.*Tc.^(-1),1)))+2.*a.*exp(1).^((-1).*a.^(-1/2).*(( ...
                -1)+(x.^2+y.^2).^(1/2)).^2).*y.*(x.^2+y.^2).^2.*(1+(-1).*(x.^2+ ...
                y.^2).^(1/2)).*(u0+(-1).*u0.*x+exp(1).^((-1).*alpha.^(-2).*((-1)+ ...
                x).^2+(-1).*y.^2).*u0.*((-1)+x).*((-1)+exp(1).^(alpha.^(-2).*((-1) ...
                +x).^2+y.^2)+2.*y.^2)+2.*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.^2.*w.* ...
                (y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1))+2.*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).* ...
                y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+(-1).* ...
                y0).*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(t.*Tc.^(-1), ...
                1)))+(-2).*a.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*y.^2.*(x.^2+y.^2).^(3/2).*((-1).*exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.*exp(1).^((-1) ...
                .*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1) ...
                ).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod(( ...
                -1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+( ...
                -1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs( ...
                sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)))+(-2).* ...
                a.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*y.^2.* ...
                (x.^2+y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1) ...
                ))+2.*a.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).* ...
                (x.^2+y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*((-1).*exp(1).^((-1) ...
                .*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1) ...
                ))+4.*a.^(1/2).*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2) ...
                ).^2).*(x.^2+y.^2).^(3/2).*(y+(-1).*y.*(x.^2+y.^2).^(1/2)).^2.*(( ...
                -1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*(( ...
                -1)+x).*y+alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+( ...
                -1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.* ...
                Tc.^(-1))).*((-1)+x+(-1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)))+2.*a.^(3/2).*(1+(-1).*exp(1).^((-1).* ...
                a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2)).*(x.^2+y.^2).^(5/2).*(( ...
                -1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*(2+exp( ...
                1).^(alpha.^(-2).*((-1)+x).^2+y.^2)).*u0.*((-1)+x).*y+exp(1).^(( ...
                -1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y.*((-1)+ ...
                exp(1).^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+alpha.^4.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.* ...
                Tc.^(-1),1)).^2)).*R0.^2.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+2.*alpha.^6.*exp(1).^((-1).* ...
                R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)) ...
                .^2)).*R0.^3.*w.*(y+y0).^2.*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1))+2.*alpha.^6.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.^3.*w.*(y+(-1).*y0).^2.*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1) ...
                .*L.*mod(t.*Tc.^(-1),1))+alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.* ...
                abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1))));
            
            out.d2vdxdy(1:np,1) = 2.*a.^(-3/2).*alpha.^(-4).*(x.^2+y.^2).^(-5/2).*(3.*a.*alpha.^4.* ...
                exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.^2.*y.* ...
                (x.^2+y.^2).^(1/2).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+( ...
                1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.* ...
                Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+ ...
                (-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1)))) ...
                +(-1).*a.*alpha.^4.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*y.*(x.^2+y.^2).^(3/2).*((1+(-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+3.*a.*alpha.^4.*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.^2.*y.*(1+(-1).*(x.^2+ ...
                y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+( ...
                -1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1) ...
                .*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1) ...
                ))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+ ...
                L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-1).* ...
                a.*alpha.^4.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*y.*(x.^2+y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((1+(-1).*exp( ...
                1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+(-6).*a.^(1/2).*alpha.^4.*exp(1).^(( ...
                -1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.^2.*y.*(x.^2+ ...
                y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*((1+(-1).*exp(1).^((-1).* ...
                alpha.^(-2).*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*w.*abs(cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                w.*abs(sin(pi.*t.*Tc.^(-1))))+4.*alpha.^4.*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.^2.*y.*(x.^2+y.^2).*(1+( ...
                -1).*(x.^2+y.^2).^(1/2)).^3.*((1+(-1).*exp(1).^((-1).*alpha.^(-2) ...
                .*((-1)+x).^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*( ...
                y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs( ...
                cos(pi.*t.*Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1) ...
                .*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.* ...
                t.*Tc.^(-1))))+2.*a.^(1/2).*alpha.^4.*exp(1).^((-1).*a.^(-1/2).*(( ...
                -1)+(x.^2+y.^2).^(1/2)).^2).*y.*(x.^2+y.^2).^(3/2).*((-1)+(x.^2+ ...
                y.^2).^(1/2)).^2.*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+( ...
                1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.* ...
                Tc.^(-1)))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+ ...
                (-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1)))) ...
                +(-6).*a.^(1/2).*alpha.^4.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+ ...
                y.^2).^(1/2)).^2).*y.*(x.^2+y.^2).^(1/2).*(x+(-1).*x.*(x.^2+y.^2) ...
                .^(1/2)).^2.*((1+(-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+( ...
                -1).*y.^2)).*u0.*y+exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1) ...
                .*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*w.*abs(cos(pi.*t.*Tc.^(-1) ...
                ))+(-1).*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+ ...
                L.*mod(t.*Tc.^(-1),1)).^2)).*w.*abs(sin(pi.*t.*Tc.^(-1))))+(-1).* ...
                a.*alpha.^4.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)) ...
                .^2).*x.^2.*(x.^2+y.^2).^(3/2).*(exp(1).^((-1).*alpha.^(-2).*((-1) ...
                +x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+x).^2+ ...
                y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+ ...
                y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+ ...
                y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))))+(-1).*a.* ...
                alpha.^4.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2) ...
                .*x.^2.*(x.^2+y.^2).*(1+(-1).*(x.^2+y.^2).^(1/2)).*(exp(1).^((-1) ...
                .*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^( ...
                alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+a.*alpha.^4.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^( ...
                1/2)).^2).*(x.^2+y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(exp(1) ...
                .^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+exp(1).^( ...
                alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).*alpha.^2.*exp(1).^(( ...
                -1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1) ...
                ,1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+2.*alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1) ...
                )))+2.*a.^(1/2).*alpha.^4.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+ ...
                y.^2).^(1/2)).^2).*(x.^2+y.^2).^(3/2).*(x+(-1).*x.*(x.^2+y.^2).^( ...
                1/2)).^2.*(exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).* ...
                u0.*((-1)+exp(1).^(alpha.^(-2).*((-1)+x).^2+y.^2)+2.*y.^2)+(-2).* ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.* ...
                mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+y0).*abs(cos(pi.*t.* ...
                Tc.^(-1)))+2.*alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0) ...
                .^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*(y+(-1).*y0).* ...
                abs(sin(pi.*t.*Tc.^(-1))))+(-4).*a.*alpha.^2.*exp(1).^((-1).*a.^( ...
                -1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*(x.^2+y.^2).^2.*(1+(-1).* ...
                (x.^2+y.^2).^(1/2)).*((-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x) ...
                .^2+(-1).*y.^2).*u0.*((-1)+x)+2.*exp(1).^((-1).*alpha.^(-2).*((-1) ...
                +x).^2+(-1).*y.^2).*u0.*((-1)+x).*y.^2+2.*alpha.^4.*exp(1).^((-1) ...
                .*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1) ...
                ).^2)).*R0.^2.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1))+2.*alpha.^4.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.^2.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))).*((-1)+x+(-1).* ...
                L.*mod(t.*Tc.^(-1),1)))+4.*a.*alpha.^2.*exp(1).^((-1).*a.^(-1/2).* ...
                ((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).^(3/2).*((-1).* ...
                exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x) ...
                .*y+alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+ ...
                L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1) ...
                )).*((-1)+x+(-1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1) ...
                .^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^( ...
                -1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod( ...
                t.*Tc.^(-1),1)))+4.*a.*alpha.^2.*exp(1).^((-1).*a.^(-1/2).*((-1)+( ...
                x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).*(1+(-1).*(x.^2+y.^2).^( ...
                1/2)).*((-1).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2) ...
                .*u0.*((-1)+x).*y+alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0) ...
                .^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos( ...
                pi.*t.*Tc.^(-1))).*((-1)+x+(-1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+ ...
                alpha.^2.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*( ...
                1+(-1).*x+L.*mod(t.*Tc.^(-1),1)))+(-8).*a.^(1/2).*exp(1).^((-1).* ...
                a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).*x.*y.*(x.^2+y.^2).^(3/2) ...
                .*(alpha+(-1).*alpha.*(x.^2+y.^2).^(1/2)).^2.*((-1).*exp(1).^((-1) ...
                .*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).*y+alpha.^2.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^(-1))).*((-1)+x+( ...
                -1).*L.*mod((-1/2)+t.*Tc.^(-1),1))+alpha.^2.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.*w.*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1) ...
                ))+2.*a.*exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2).* ...
                y.*(x.^2+y.^2).^2.*(1+(-1).*(x.^2+y.^2).^(1/2)).*(alpha.^2.*exp(1) ...
                .^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*y+(-2).*exp(1) ...
                .^((-1).*alpha.^(-2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).^2.*y+ ...
                (-1).*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).* ...
                x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(cos(pi.*t.*Tc.^( ...
                -1)))+alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+( ...
                -1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.*w.*abs(sin(pi.*t.*Tc.^(-1) ...
                ))+2.*alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).* ...
                x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*abs(cos(pi.*t.* ...
                Tc.^(-1))).*(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2+(-2).* ...
                alpha.^4.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+(-1).* ...
                x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*abs(sin(pi.*t.*Tc.^(-1))) ...
                .*(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)+(-1).*a.^(3/2).*(1+(-1).* ...
                exp(1).^((-1).*a.^(-1/2).*((-1)+(x.^2+y.^2).^(1/2)).^2)).*(x.^2+ ...
                y.^2).^(5/2).*(alpha.^2.*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+( ...
                -1).*y.^2).*u0+(-2).*exp(1).^((-1).*alpha.^(-2).*((-1)+x).^2+(-1) ...
                .*y.^2).*u0.*((-1)+x).^2+(-2).*alpha.^2.*exp(1).^((-1).*alpha.^( ...
                -2).*((-1)+x).^2+(-1).*y.^2).*u0.*y.^2+4.*exp(1).^((-1).*alpha.^( ...
                -2).*((-1)+x).^2+(-1).*y.^2).*u0.*((-1)+x).^2.*y.^2+2.*alpha.^6.* ...
                exp(1).^((-1).*R0.*(alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+ ...
                t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1)))+ ...
                (-2).*alpha.^6.*exp(1).^((-1).*R0.*(alpha.^2.*(y+(-1).*y0).^2+(1+( ...
                -1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).*R0.^2.*w.*(y+(-1).*y0).*abs( ...
                sin(pi.*t.*Tc.^(-1)))+(-4).*alpha.^6.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+y0).^2+(1+(-1).*x+L.*mod((-1/2)+t.*Tc.^(-1),1)).^2)) ...
                .*R0.^3.*w.*(y+y0).*abs(cos(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.*mod(( ...
                -1/2)+t.*Tc.^(-1),1)).^2+4.*alpha.^6.*exp(1).^((-1).*R0.*( ...
                alpha.^2.*(y+(-1).*y0).^2+(1+(-1).*x+L.*mod(t.*Tc.^(-1),1)).^2)).* ...
                R0.^3.*w.*(y+(-1).*y0).*abs(sin(pi.*t.*Tc.^(-1))).*(1+(-1).*x+L.* ...
                mod(t.*Tc.^(-1),1)).^2));
            
            out.dudz(1:np,1)    = 0;
            out.d2udz(1:np,1)   = 0;
            out.d2udxdz(1:np,1) = 0;
            out.d2udydz(1:np,1) = 0;
            out.dvdz(1:np,1)    = 0;
            out.d2vdz(1:np,1)   = 0;
            out.d2vdxdz(1:np,1) = 0;
            out.d2vdydz(1:np,1) = 0;
            
            out.w(1:np,1)       = 0;
            out.dwdx(1:np,1)    = 0;
            out.dwdy(1:np,1)    = 0;
            out.dwdz(1:np,1)    = 0;
            out.d2wdx(1:np,1)   = 0;
            out.d2wdy(1:np,1)   = 0;
            out.d2wdz(1:np,1)   = 0;
            out.d2wdxdy(1:np,1) = 0;
            out.d2wdxdz(1:np,1) = 0;
            out.d2wdydz(1:np,1) = 0;
            
            out.vorticity = out.dvdx-out.dudy;
            
        end
        
        out.u = out.u.*(rad>1);
        out.v = out.v.*(rad>1);
        
        
    case 3 % Double Gyre Flow ---------------------------------------------
        
        epsilon = dataFlow.e; % 0.1;
        w       = dataFlow.w;% 2*pi/10;
        A       = dataFlow.A;% 0.1;
        
        out.Psi = A.*sin(pi.*y).*sin(pi.*(epsilon.*x.^2.*sin(t.*w)+x.*(1+(-2).* ...
            epsilon.*sin(t.*w))));
        
        out.u(1:np,1)     = (-1).*A.*pi.*cos(pi.*y).*sin(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.* ...
            w)));
        out.dudx(1:np,1)    = (-1).*A.*pi.^2.*cos(pi.*y).*cos(pi.*x.*(1+epsilon.*((-2)+x).*sin( ...
            t.*w))).*(1+2.*epsilon.*((-1)+x).*sin(t.*w));
        out.dudy(1:np,1)    = A.*pi.^2.*sin(pi.*y).*sin(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w)));
        out.d2udx(1:np,1)   = A.*pi.^2.*cos(pi.*y).*((-2).*epsilon.*cos(pi.*x.*(1+epsilon.*((-2) ...
            +x).*sin(t.*w))).*sin(t.*w)+pi.*(1+2.*epsilon.*((-1)+x).*sin(t.*w) ...
            ).^2.*sin(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))));
        out.d2udy(1:np,1)   = A.*pi.^3.*cos(pi.*y).*sin(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w)));
        out.d2udxdy(1:np,1) = A.*pi.^3.*cos(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))).*(1+2.* ...
            epsilon.*((-1)+x).*sin(t.*w)).*sin(pi.*y);
        
        out.v(1:np,1)       = A.*pi.*cos(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))).*(1+2.* ...
            epsilon.*((-1)+x).*sin(t.*w)).*sin(pi.*y);
        out.dvdx(1:np,1)    = A.*pi.*sin(pi.*y).*(2.*epsilon.*cos(pi.*x.*(1+epsilon.*((-2)+x).* ...
            sin(t.*w))).*sin(t.*w)+(-1).*pi.*(1+2.*epsilon.*((-1)+x).*sin(t.* ...
            w)).^2.*sin(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))));
        out.dvdy(1:np,1)    = A.*pi.^2.*cos(pi.*y).*cos(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))) ...
            .*(1+2.*epsilon.*((-1)+x).*sin(t.*w));
        out.d2vdx(1:np,1)   = A.*pi.^2.*(1+2.*epsilon.*((-1)+x).*sin(t.*w)).*sin(pi.*y).*((-1).* ...
            pi.*cos(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))).*(1+2.*epsilon.*( ...
            (-1)+x).*sin(t.*w)).^2+(-6).*epsilon.*sin(t.*w).*sin(pi.*x.*(1+ ...
            epsilon.*((-2)+x).*sin(t.*w))));
        out.d2vdy(1:np,1)   = (-1).*A.*pi.^3.*cos(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))).*(1+ ...
            2.*epsilon.*((-1)+x).*sin(t.*w)).*sin(pi.*y);
        out.d2vdxdy(1:np,1) = A.*pi.^2.*cos(pi.*y).*(2.*epsilon.*cos(pi.*x.*(1+epsilon.*((-2)+x) ...
            .*sin(t.*w))).*sin(t.*w)+(-1).*pi.*(1+2.*epsilon.*((-1)+x).*sin( ...
            t.*w)).^2.*sin(pi.*x.*(1+epsilon.*((-2)+x).*sin(t.*w))));
        
        
    case 4 % Sine flow --------------------------------------------------------
        
        k   = dataFlow.k;
        A   = dataFlow.A;
        w   = dataFlow.w;
        phi = dataFlow.phi;
        u0  = dataFlow.u0;
        out.u(1:np,1)     = u0+A*sin(phi-t*w+k*x);
        out.dudx(1:np,1)  = A.*k.*cos(phi+(-1).*t.*w+k.*x);
        out.d2udx(1:np,1) = (-1).*A.*k.^2.*sin(phi+(-1).*t.*w+k.*x);
        
        out.dudy(1:np,1)  = 0;
        out.d2udy(1:np,1) = 0;
        out.dudz(1:np,1)  = 0;
        out.d2udz(1:np,1) = 0;
        out.d2udxdy(1:np,1) = 0;
        out.d2udxdz(1:np,1) = 0;
        out.d2udydz(1:np,1) = 0;
        
        out.v(1:np,1)     = 0;
        out.dvdx(1:np,1)  = 0;
        out.d2vdx(1:np,1) = 0;
        out.dvdy(1:np,1)  = 0;
        out.d2vdy(1:np,1) = 0;
        out.dvdz(1:np,1)  = 0;
        out.d2vdz(1:np,1) = 0;
        out.d2vdxdy(1:np,1) = 0;
        out.d2vdxdz(1:np,1) = 0;
        out.d2vdydz(1:np,1) = 0;
        
        out.w(1:np,1)     = 0;
        out.dwdx(1:np,1)  = 0;
        out.d2wdx(1:np,1) = 0;
        out.dwdy(1:np,1)  = 0;
        out.d2wdy(1:np,1) = 0;
        out.dwdz(1:np,1)  = 0;
        out.d2wdz(1:np,1) = 0;
        out.d2wdxdy(1:np,1) = 0;
        out.d2wdxdz(1:np,1) = 0;
        out.d2wdydz(1:np,1) = 0;
end

end










